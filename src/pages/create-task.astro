---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Crear un nueva tarea">
    <section class="section-form">
        <form action="" class="form">
            <h1>Agregar una nueva tarea</h1>
            <div class="input-form-task">
                <label for="">Ingrese los datos de la nueva tarea</label>
                <textarea class="input-task input-task-text" name="task" id="" placeholder="Detalles sobre la tarea" required> </textarea>
            </div>
            <div class="input-form-task">
                <label for="">Seleccione la fecha m√°xima para hacer la tarea</label>
                <input type="datetime-local" name="date_to_do" id="" class="input-date-task input-task" required/>
            </div>
            <div class="input-form-task">
                <input type="submit" class="btn-submit input-task" value="Agregar Tarea"/>
            </div>
        </form>
    </section>
</Layout>


<script>
    document.addEventListener('DOMContentLoaded', ()=>{
        getData();
    });

    function getData(){
        const form = document.querySelector('.form');
        form.addEventListener('submit', async(e)=>{
            e.preventDefault();
            const taskData = Object.fromEntries(new FormData(e.target));
            const id = window.localStorage.getItem('id');
            taskData.user_id = id;
            addTask(taskData)
            .then(data => console.log(data));
        });
    }


    
    async function addTask(taskData){
        const response = await fetch('http://localhost:3000/task', {
            method: 'POST',
            body: JSON.stringify(taskData),
                headers: {
                    'Content-Type': 'application/json'
                }
        });
        return await response.json();
        
    }

</script>



<style>

    body{
        margin: 0
        min-height: 100vh;
        padding: 0;

    }

    .section-form {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: auto;
        border: 1px solid #4338ca;
        width: 30rem;
        /* margin: 5rem auto; */
        border-radius: 1rem; 
        height: 30rem;
        box-shadow: 4px 5px 41px 0px rgba(0, 0, 0, 0.75);
        -webkit-box-shadow: 4px 5px 41px 0px rgba(0, 0, 0, 0.75);
        -moz-box-shadow: 4px 5px 41px 0px rgba(0, 0, 0, 0.75);
    }

    .form {
        width: 100%;
        margin: 0 auto;
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .form h1{
        margin-top: 2rem;
        margin-bottom: -.6rem;
    }

    .input-task{
        width: 80%;
        border-radius: 8px;
        height: 1.8rem;
        border: 1px solid #4338ca;
    }

    .input-task-text{
        resize: none;
        height: 8rem;
    }

    .btn-submit{
        background-color: #4338ca;
        color: white;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
    }

    .btn-submit:hover{
        background-color: rgb(85, 85, 156);
    }

    .input-form-task{
        display: flex;
        flex-direction: column;
        gap: 1rem;
        align-items: center;
        text-align: start;
    }

    
</style>
